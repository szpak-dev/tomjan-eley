---
import Layout from "../../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { languages } from "../../../i18n/ui";

export async function getStaticPaths() {
    const products = await getCollection("products");
    const langs = Object.keys(languages);

    return langs.flatMap((lang) =>
        products.map((product) => ({
            params: { lang, slug: product.data.id },
            props: { product, lang },
        })),
    );
}

const { product, lang } = Astro.props;
const { name, subname, lead, description, specification, imageUrl, category } =
    product.data;

// Helper to format specification values
function formatSpecValue(spec: any) {
    if (spec.type === "Simple") {
        return `${spec.values[0]}${spec.units[0] ? " " + spec.units[0] : ""}`;
    }
    if (spec.type === "MultipleUnits") {
        return spec.values
            .map((v: string, i: number) => `${v} ${spec.units[i] || ""}`)
            .join(" / ");
    }
    if (spec.type === "Range") {
        // Assuming range is min-max
        if (spec.values.length === 2) {
            return `${spec.values[0]} - ${spec.values[1]} ${spec.units[0] || ""}`;
        }
        return spec.values
            .map((v: string, i: number) => `${v} ${spec.units[i] || ""}`)
            .join(" - ");
    }
    return spec.values.join(", ");
}
---

<Layout title={`${name} - Eley`}>
    <div class="container py-5">
        <div class="row mb-4">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href={`/${lang}/`}>Home</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href={`/${lang}/${category}`}>{category}</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            {name}
                        </li>
                    </ol>
                </nav>
            </div>
        </div>

        <div class="row align-items-center mb-5">
            <div class="col-md-6 text-center mb-4 mb-md-0">
                <img
                    src={imageUrl}
                    alt={name}
                    class="img-fluid rounded bg-light p-4"
                    style="max-height: 400px;"
                />
            </div>
            <div class="col-md-6">
                <h1 class="display-4 fw-bold mb-0">{name}</h1>
                {subname && <h2 class="h4 text-muted mb-4">{subname}</h2>}
                <p class="lead mb-4">{lead}</p>

                <div class="description mb-4">
                    {description.map((paragraph) => <p>{paragraph}</p>)}
                </div>
            </div>
        </div>

        {
            specification && specification.length > 0 && (
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0 shadow-sm">
                            <div class="card-header bg-primary text-white">
                                <h3 class="h5 mb-0 py-1">Specifications</h3>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover mb-0">
                                        <tbody>
                                            {specification.map((spec) => (
                                                <tr>
                                                    <th
                                                        scope="row"
                                                        class="w-25 ps-4 py-3 align-middle"
                                                    >
                                                        {spec.title}
                                                    </th>
                                                    <td class="py-3 align-middle">
                                                        {formatSpecValue(spec)}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            )
        }
    </div>
</Layout>
