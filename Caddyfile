# Caddy configuration for eley.com.pl
# This file should be placed in /etc/caddy/sites/eley.com.pl

eley.com.pl {
    root * /home/tomjan/sites/eley.com.pl
    
    # Disable caching for index.html and language redirect pages
    @index {
        path /index.html /
    }
    header @index {
        Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate"
        Pragma "no-cache"
        Expires "0"
    }
    
    # Cache static assets with hash in filename (Astro generates these)
    @static {
        path_regexp \.(js|css|woff|woff2|ttf|svg|jpg|jpeg|png|gif|ico|webp)$
        path_regexp /_astro/
    }
    header @static {
        Cache-Control "public, max-age=31536000, immutable"
    }
    
    # Default cache control for other HTML pages
    @html {
        path *.html
    }
    header @html {
        Cache-Control "public, max-age=3600, must-revalidate"
    }
    
    # Enable compression
    encode gzip zstd
    
    # Serve files
    file_server
    
    # Try files in order (for clean URLs)
    try_files {path} {path}/ {path}.html {path}/index.html /index.html
}
